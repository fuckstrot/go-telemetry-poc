# 🖥️ Прототип Система Мониторинга Телеметрии

[![Go Version](https://img.shields.io/badge/go-1.18%2B-blue)](https://golang.org/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![MQTT](https://img.shields.io/badge/protocol-MQTT-blue)](https://mqtt.org/)

Прототип клиента телеметрии на Go, который собирает метрики системы и передаёт их через MQTT брокер (а дальше через kafka bridge в kafka. 
В рамках теста подписчик получает и отображает данные телеметрии в реальном времени (логирует в файлы сообщения).

## 🚀 Особенности

- **Комплексный мониторинг системы**:
  - 📊 Использование CPU, памяти и диска (% и абсолютные значения)
  - 🌐 Статистика сетевых интерфейсов и активных соединений
  - 🔝 Топ процессов по использованию ресурсов
  - 📁 Отслеживание критических файлов

- **Работа в реальном времени**:
  - 🔄 Архитектура pub/sub на основе MQTT
  - ⏱️ Настраиваемые интервалы сбора данных
  - 🔒 Безопасная передача данных

- **Надёжность**:
  - 📝 Двойная система логирования
  - 🛑 Обработка плавного завершения работы
  - ⚙️ Настраиваемые ограничения ресурсов

- **Формат вывода**:
  - 🧩 Пакеты телеметрии в JSON
  - 👁️ Человекочитаемые отчёты в консоли
  - 🕒 Постоянное логирование событий

## ⚙️ Требования

- Go 1.18+
- Брокер MQTT (Mosquitto, EMQX или облачный сервис)
- Linux/Unix или Windows система (частичная поддержка macOS)

## 🛠️ Установка

```bash
# Клонирование репозитория
git clone https://github.com/yourusername/telemetry-system.git
cd telemetry-system

# Установка зависимостей
go mod download

# Сборка приложения
go build -o telemetry-system
```

## ⚙️ Конфигурация

Создайте файл `config.json`:

```json
{
  "broker_address": "tcp://localhost:1883",
  "mqtt_topic": "telemetry/fullsystem",
  "collection_interval": 10,
  "max_processes": 50,
  "critical_files": [
    "/etc/passwd",
    "/etc/hosts"
  ],
  "log_files": {
    "system_log": "system.log",
    "event_log": "events.log"
  }
}
```

### Параметры конфигурации

| Параметр               | Описание                          | По умолчанию          |
|------------------------|-----------------------------------|-----------------------|
| `broker_address`       | URL подключения к брокеру MQTT    | Обязателен           |
| `mqtt_topic`           | Топик MQTT для данных телеметрии   | `telemetry/fullsystem` |
| `collection_interval`  | Интервал сбора в секундах         | `10`                 |
| `max_processes`        | Количество отслеживаемых процессов| `50`                 |
| `critical_files`       | Список отслеживаемых файлов       | `[]`                 |
| `log_files.system_log` | Путь к системному логу            | `system.log`         |
| `log_files.event_log`  | Путь к логу событий               | `events.log`         |

## 🚀 Использование

### Запуск системы

```bash
./telemetry-system
```

Система автоматически:
1. Запустит компоненты публикации и подписки
2. Подключится к MQTT брокеру
3. Начнёт сбор и публикацию телеметрии
4. Логировать данные в консоль и файлы

### Пример вывода

```text
=== Отчёт по телеметрии системы ===
🕒 Временная метка: 2023-07-15T14:30:45Z

[💻 Система]
🏷️ Имя хоста: server-01
🖥️ ОС: ubuntu 22.04 (Ядро: 5.15.0-76-generic)
⏱️ Аптайм: 02d 14h 30m 45s
🌐 IP-адреса: 192.168.1.100, 10.0.0.2
⚙️ ЦПУ: 8 | Go: go1.20.4

[🔧 Оборудование]
🚀 ЦПУ: 24.75%
🧠 Память: 65.33% (5.2 ГБ / 8.0 ГБ)
💾 Диск: 42.15% (42.1 ГБ / 100.0 ГБ)

[🌐 Сеть]
📤 Общий трафик: ↑ 124.25МБ ↓ 984.72МБ

🔗 Активные соединения (12):
- tcp  192.168.1.100:22 → 203.0.113.5:64231 [ESTABLISHED]
- tcp  0.0.0.0:80      → 0.0.0.0:0        [LISTEN]

[📈 Топ-10 процессов]
   PID Имя      CPU% MEM%      RSS Потоки Ввод-вывод Статус
  1234 node    15.5  12.3  1.2 ГБ  32 ↑1.4МБ↓24МБ running
  5678 dockerd  8.2   8.7 870.4 МБ 45 ↑24МБ↓1.2МБ sleeping

[📁 Критические файлы]
- /etc/passwd (1.2 КБ, изменён 2023-07-01T09:00:00Z)
```

### Параметры командной строки

| Опция        | Описание                              |
|--------------|---------------------------------------|
| `-config`    | Путь к пользовательскому конфигу      |
| `-version`   | Показать версию приложения            |
| `-debug`     | Включить подробное логирование        |

## 📂 Структура проекта

```
telemetry-system/
├── main.go                 # Точка входа
├── config.json             # Конфигурация
├── go.mod                  # Зависимости Go
├── system.log              # Системный лог
├── events.log              # Лог событий
├── pkg/
│   ├── collector/          # Сбор метрик
│   ├── publisher/          # Публикация MQTT
│   ├── subscriber/         # Подписка MQTT
│   └── models/             # Структуры данных
└── README.md               # Документация
```

## 📜 Лицензия

Этот проект лицензирован по лицензии MIT - подробности см. в файле [LICENSE](LICENSE).

## 🤝 Вклад в проект

Приветствуются вклады! Пожалуйста, следуйте следующим шагам:

1. Форкните репозиторий
2. Создайте ветку для вашей функции (`git checkout -b feature/новая-функция`)
3. Зафиксируйте изменения (`git commit -am 'Добавить новую функцию'`)
4. Отправьте ветку (`git push origin feature/новая-функция`)
5. Откройте pull request

## 🗺️ План развития

- [x] Базовый сбор телеметрии
- [x] Интеграция с MQTT
- [x] Абсолютные значения для памяти/диска
- [ ] Контейнеризация Docker
- [ ] Endpoint метрик Prometheus
- [ ] Система оповещений
- [ ] Веб-панель мониторинга

## ❓ Поддержка

Для сообщений об ошибках и запросов функций, пожалуйста, [откройте issue](https://github.com/yourusername/telemetry-system/issues).

---

**Теги**: `go` `телеметрия` `мониторинг` `mqtt` `системные метрики` `опенсорс`

## 📊 Архитектура системы
Диаграмма ниже показывает основные компоненты системы и их взаимодействие:

```mermaid
graph TD
    subgraph Телеметрическая Система
        A[Конфигурация config.json] -->|Чтение| B[Основной Процесс]
        B --> C[Публикатор]
        B --> D[Подписчик]
        
        subgraph Публикатор
            C1[Сбор Системной Информации]
            C2[Сбор Аппаратных Метрик]
            C3[Сбор Сетевых Данных]
            C4[Сбор Данных Процессов]
            C5[Проверка Критических Файлов]
            C6[Формирование JSON]
            
            C --> C1
            C --> C2
            C --> C3
            C --> C4
            C --> C5
            C --> C6
            C6 -->|Отправка| E[MQTT Брокер]
        end
        
        subgraph Подписчик
            D1[Обработка Сообщений]
            D2[Декодирование JSON]
            D3[Запись в Лог Событий]
            D4[Вывод в Консоль]
            
            D -->|Подписка| E
            D --> D1
            D1 --> D2
            D2 --> D3
            D2 --> D4
        end
        
        E -->|Telemetry Data| D
    end
    
    style A fill:#f9f,stroke:#333,stroke-width:2px
    style E fill:#9cf,stroke:#333,stroke-width:2px
